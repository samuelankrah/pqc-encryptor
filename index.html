<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>PQC Encryptor ‚Äì Real Kyber</title>
  <style>
    body { max-width: 700px; margin: auto; padding: 2rem; font-family: sans-serif; background:#111; color:#f4f4f4; }
    textarea, button { width: 100%; padding:1rem; margin-top:1rem; font-size:1rem; border-radius:8px; border:none; }
    button { background:#00cec9;color:#fff;cursor:pointer;font-weight:bold; }
    .output { background:#2d3436;padding:1rem;margin-top:1.5rem;border-radius:8px;word-wrap:break-word; }
  </style>
</head>
<body>
  <h1>üîê PQC Encryptor (Kyber768 + AES-GCM)</h1>
  <textarea id="plaintext" rows="5" placeholder="Type a message..."></textarea>
  <button id="encryptBtn">Encrypt</button>
  <div class="output" id="results" hidden>
    <h3>Encrypted Results (Base64)</h3>
    <strong>Ciphertext:</strong><div id="ciphertext"></div>
    <strong>Shared Secret:</strong><div id="shared"></div>
  </div>

  <script type="module">
    import { MlKem768 as Kyber } from "https://esm.sh/mlkem@latest";
    const encryptBtn = document.getElementById("encryptBtn");
    async function encrypt() {
      const text = document.getElementById("plaintext").value;
      const encoder = new TextEncoder();
      const plaintext = encoder.encode(text);

      const recipient = new Kyber();
      const [pk, sk] = await recipient.generateKeyPair();

      const sender = new Kyber();
      const [ciphertextBytes, sharedSecretSender] = await sender.encap(pk);

      const sharedSecretReceiver = await recipient.decap(ciphertextBytes, sk);

      const key = await crypto.subtle.importKey("raw", sharedSecretSender, { name: "AES-GCM" }, false, ["encrypt"]);
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const encrypted = await crypto.subtle.encrypt({ name:"AES-GCM", iv }, key, plaintext);
      const full = new Uint8Array(iv.length + encrypted.byteLength);
      full.set(iv,0);
      full.set(new Uint8Array(encrypted), iv.length);

      const b64Cipher = btoa(String.fromCharCode(...full));
      const b64Secret = btoa(String.fromCharCode(...sharedSecretSender));
      document.getElementById("ciphertext").textContent = b64Cipher;
      document.getElementById("shared").textContent = b64Secret;
      document.getElementById("results").hidden = false;
    }
    encryptBtn.onclick = encrypt;
  </script>
</body>
</html>
